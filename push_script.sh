#!/bin/bash
set -euo pipefail

function git_add_path() {
    # 1. –ü—Ä–æ–≤–µ—Ä–∫–∞ Git-—Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏—è
    if ! git rev-parse --is-inside-work-tree >/dev/null 2>&1; then
        echo "–û—à–∏–±–∫–∞: –¢–µ–∫—É—â–∞—è –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏—è –Ω–µ —è–≤–ª—è–µ—Ç—Å—è Git-—Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–µ–º."
        return 1
    fi

    # 2. –ü–æ–ª—É—á–µ–Ω–∏–µ –ø—É—Ç–∏
    echo -n "–£–∫–∞–∂–∏—Ç–µ –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏—é –∏–ª–∏ —Ñ–∞–π–ª: "
    read -r user_input

    # 3. –ù–æ—Ä–º–∞–ª–∏–∑–∞—Ü–∏—è –ø—É—Ç–∏
    local path
    path="${user_input/#\~/$HOME}"
    path=$(realpath -m "$path" 2>/dev/null || echo "$path")

    # 4. –ü—Ä–æ–≤–µ—Ä–∫–∞ —É–∫–∞–∑–∞–Ω–∏—è –ø—É—Ç–∏
    if [[ -z "${path// }" ]]; then
        echo "–û—à–∏–±–∫–∞: –ü—É—Ç—å –Ω–µ —É–∫–∞–∑–∞–Ω."
        return 1
    fi

    # 5. –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å—É—â–µ—Å—Ç–≤–æ–≤–∞–Ω–∏—è –ø—É—Ç–∏
    if [[ ! -e "$path" ]]; then
        echo "–û—à–∏–±–∫–∞: –ü—É—Ç—å '$path' –Ω–µ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç."
        return 1
    fi

    # 6. –ü—Ä–æ–≤–µ—Ä–∫–∞ –∏–∑–º–µ–Ω–µ–Ω–∏–π
    if [[ -z $(git status --porcelain "$path" 2>/dev/null) ]]; then
        echo "–ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è: '$path' –Ω–µ –∏–º–µ–µ—Ç –∏–∑–º–µ–Ω–µ–Ω–∏–π –¥–ª—è –¥–æ–±–∞–≤–ª–µ–Ω–∏—è."
        read -rp "–í—Å–µ —Ä–∞–≤–Ω–æ –¥–æ–±–∞–≤–∏—Ç—å? (y/N): " force_add
        if [[ ! "$force_add" =~ ^[Yy]$ ]]; then
            echo "–û–ø–µ—Ä–∞—Ü–∏—è –æ—Ç–º–µ–Ω–µ–Ω–∞."
            return 0
        fi
    fi

    # 7. –í—ã–ø–æ–ª–Ω–µ–Ω–∏–µ –¥–æ–±–∞–≤–ª–µ–Ω–∏—è
    if git add -v "$path"; then
        echo "–£—Å–ø–µ—Ö: '$path' –¥–æ–±–∞–≤–ª–µ–Ω –≤ –∏–Ω–¥–µ–∫—Å."
        echo "–°—Ç–∞—Ç—É—Å –¥–æ–±–∞–≤–ª–µ–Ω–Ω–æ–≥–æ:"
        git status -s "$path"
    else
        echo "–û—à–∏–±–∫–∞: –ù–µ —É–¥–∞–ª–æ—Å—å –¥–æ–±–∞–≤–∏—Ç—å '$path' –≤ –∏–Ω–¥–µ–∫—Å."
        return 1
    fi
}

function commit_git() {
    # –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –ª–æ–∫–∞–ª—å –¥–ª—è –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ–π —Ä–∞–±–æ—Ç—ã —Å UTF-8
    export LC_ALL="en_US.UTF-8"
    export LANG="en_US.UTF-8"
    
    # 1. –ü—Ä–æ–≤–µ—Ä–∫–∞ –∏–º–µ–Ω–∏ –∞–≤—Ç–æ—Ä–∞ –∏ email
    USER_NAME=$(git config user.name)
    USER_EMAIL=$(git config user.email)

    if [[ -z "$USER_NAME" || -z "$USER_EMAIL" ]]; then
        echo "–û—à–∏–±–∫–∞: –ê–≤—Ç–æ—Ä –Ω–µ –Ω–∞—Å—Ç—Ä–æ–µ–Ω!"
        echo "–í—ã–ø–æ–ª–Ω–∏—Ç–µ:"
        echo 'git config --global user.name "Your Name"'
        echo 'git config --global user.email "you@example.com"'
        return 1
    fi

    # 2. –ü—Ä–æ–≤–µ—Ä–∫–∞, —á—Ç–æ –µ—Å—Ç—å –∏–∑–º–µ–Ω–µ–Ω–∏—è –¥–ª—è –∫–æ–º–º–∏—Ç–∞
    if ! git diff --cached --quiet; then
        echo "–ï—Å—Ç—å –∏–∑–º–µ–Ω–µ–Ω–∏—è, –≥–æ—Ç–æ–≤—ã–µ –∫ –∫–æ–º–º–∏—Ç—É (staged)."
    else
        echo "–ò–Ω–¥–µ–∫—Å –ø—É—Å—Ç. –ù–µ—á–µ–≥–æ –∫–æ–º–º–∏—Ç–∏—Ç—å (—Å–Ω–∞—á–∞–ª–∞ —Å–¥–µ–ª–∞–π—Ç–µ git add)."
        return 1
    fi

    # 3. –ü–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ –∫–æ–º–º–∏—Ç–∞ –ø–µ—Ä–µ–¥ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–µ–º
    echo "–ë—É–¥—É—Ç –∑–∞–∫–æ–º–º–∏—á–µ–Ω—ã —Å–ª–µ–¥—É—é—â–∏–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è:"
    git diff --cached --name-status

    read -rp "–ü—Ä–æ–¥–æ–ª–∂–∏—Ç—å –∫–æ–º–º–∏—Ç? (y/N): " confirm
    if [[ ! "$confirm" =~ ^[Yy]$ ]]; then
        echo "–û–ø–µ—Ä–∞—Ü–∏—è –æ—Ç–º–µ–Ω–µ–Ω–∞."
        return 0
    fi   

    # 4. –õ–∏–º–∏—Ç—ã –¥–ª–∏–Ω—ã (Best Practice –æ—à–∏–±–∫–∞) 50 —Å–∏–º–≤–æ–ª–æ–≤
    read -rp "–í–≤–µ–¥–∏—Ç–µ —Å–æ–æ–±—â–µ–Ω–∏–µ –∫–æ–º–º–∏—Ç–∞ (–¥–æ 50 —Å–∏–º–≤–æ–ª–æ–≤): " commit_msg
    
    # –¢—Ä–∏–º–º–∏–Ω–≥ –∏ –Ω–æ—Ä–º–∞–ª–∏–∑–∞—Ü–∏—è –∫–æ–¥–∏—Ä–æ–≤–∫–∏
    commit_msg=$(echo "$commit_msg" | sed 's/^[[:space:]]*//;s/[[:space:]]*$//')
    
    # 5. –§—É–Ω–∫—Ü–∏—è –¥–ª—è –Ω–æ—Ä–º–∞–ª–∏–∑–∞—Ü–∏–∏ –∫–æ–¥–∏—Ä–æ–≤–∫–∏ —Ç–µ–∫—Å—Ç–∞ –≤ UTF-8
    normalize_to_utf8() {
        local input="$1"
        # –ü—Ä–æ–≤–µ—Ä—è–µ–º, —è–≤–ª—è–µ—Ç—Å—è –ª–∏ —Ç–µ–∫—Å—Ç –≤–∞–ª–∏–¥–Ω—ã–º UTF-8
        if echo "$input" | iconv -f utf-8 -t utf-8 >/dev/null 2>&1; then
            echo "$input"
        else
            # –ü—ã—Ç–∞–µ–º—Å—è –æ–ø—Ä–µ–¥–µ–ª–∏—Ç—å –∏ –∫–æ–Ω–≤–µ—Ä—Ç–∏—Ä–æ–≤–∞—Ç—å –∫–æ–¥–∏—Ä–æ–≤–∫—É
            local detected_encoding
            detected_encoding=$(echo "$input" | uchardet 2>/dev/null || echo "")
            
            if [[ -n "$detected_encoding" && "$detected_encoding" != "unknown" ]]; then
                echo "$input" | iconv -f "$detected_encoding" -t utf-8//IGNORE 2>/dev/null || echo "$input"
            else
                # –ü—Ä–æ–±—É–µ–º —Ä–∞—Å–ø—Ä–æ—Å—Ç—Ä–∞–Ω–µ–Ω–Ω—ã–µ –∫–æ–¥–∏—Ä–æ–≤–∫–∏
                for enc in windows-1251 cp1251 koi8-r iso-8859-5; do
                    if echo "$input" | iconv -f "$enc" -t utf-8 >/dev/null 2>&1; then
                        echo "$input" | iconv -f "$enc" -t utf-8 2>/dev/null
                        return 0
                    fi
                done
                echo "$input"  # –í–æ–∑–≤—Ä–∞—â–∞–µ–º –∫–∞–∫ –µ—Å—Ç—å, –µ—Å–ª–∏ –Ω–µ —É–¥–∞–ª–æ—Å—å –∫–æ–Ω–≤–µ—Ä—Ç–∏—Ä–æ–≤–∞—Ç—å
            fi
        fi
    }
    
    # –ù–æ—Ä–º–∞–ª–∏–∑—É–µ–º —Å–æ–æ–±—â–µ–Ω–∏–µ –∫–æ–º–º–∏—Ç–∞
    commit_msg=$(normalize_to_utf8 "$commit_msg")
    
    # 5. –ü—Ä–æ–≤–µ—Ä–∫–∞, —á—Ç–æ —Å–æ–æ–±—â–µ–Ω–∏–µ –∫–æ–º–º–∏—Ç–∞ –Ω–µ –ø—É—Å—Ç–æ–µ
    if [[ -z "$commit_msg" ]]; then
        echo "–û—à–∏–±–∫–∞: —Å–æ–æ–±—â–µ–Ω–∏–µ –∫–æ–º–º–∏—Ç–∞ –Ω–µ –º–æ–∂–µ—Ç –±—ã—Ç—å –ø—É—Å—Ç—ã–º"
        return 1
    fi

    # –ü—Ä–æ–≤–µ—Ä–∫–∞ –¥–ª–∏–Ω—ã –≤ —Å–∏–º–≤–æ–ª–∞—Ö (UTF-8 —Å–æ–≤–º–µ—Å—Ç–∏–º–∞—è)
    msg_length=$(echo -n "$commit_msg" | wc -m)
    if (( msg_length > 50 )); then
        echo "–û—à–∏–±–∫–∞: –∑–∞–≥–æ–ª–æ–≤–æ–∫ –∫–æ–º–º–∏—Ç–∞ –ø—Ä–µ–≤—ã—à–∞–µ—Ç 50 —Å–∏–º–≤–æ–ª–æ–≤ (—Å–µ–π—á–∞—Å: $msg_length)"
        echo "–í–∞—à —Ç–µ–∫—Å—Ç: '$commit_msg'"
        return 1
    fi

    # 6. –§—É–Ω–∫—Ü–∏—è –¥–ª—è –≤–≤–æ–¥–∞ —Ç–µ–ª–∞ –∫–æ–º–º–∏—Ç–∞ —Å –ø—Ä–æ–≤–µ—Ä–∫–æ–π –¥–ª–∏–Ω—ã —Å—Ç—Ä–æ–∫
    get_commit_body() {
        local body=""
        local line
        local line_count=0
        
        echo "–í–≤–µ–¥–∏—Ç–µ —Ç–µ–ª–æ –∫–æ–º–º–∏—Ç–∞. –ö–∞–∂–¥–∞—è —Å—Ç—Ä–æ–∫–∞ ‚â§ 72 —Å–∏–º–≤." >&2
        echo "–í–≤–µ–¥–∏—Ç–µ '--' –Ω–∞ –æ—Ç–¥–µ–ª—å–Ω–æ–π —Å—Ç—Ä–æ–∫–µ –¥–ª—è –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è." >&2
        echo "–ò–ª–∏ –Ω–∞–∂–º–∏—Ç–µ Ctrl+D –¥–ª—è –æ—Ç–º–µ–Ω—ã." >&2
        
        while IFS= read -r -p "> " line; do
            # –ü—Ä–æ–≤–µ—Ä—è–µ–º –Ω–∞ —Ä–∞–∑–¥–µ–ª–∏—Ç–µ–ª—å
            if [[ "$line" == "--" ]]; then
                break
            fi
            
            # –ù–æ—Ä–º–∞–ª–∏–∑—É–µ–º –∫–æ–¥–∏—Ä–æ–≤–∫—É –∫–∞–∂–¥–æ–π —Å—Ç—Ä–æ–∫–∏
            line=$(normalize_to_utf8 "$line")
            
            # –ü—Ä–æ–≤–µ—Ä—è–µ–º –¥–ª–∏–Ω—É —Å—Ç—Ä–æ–∫–∏
            line_length=$(echo -n "$line" | wc -m)
            if (( line_length > 72 )); then
                echo "‚ùå –°—Ç—Ä–æ–∫–∞ > 72 —Å–∏–º–≤. (—Å–µ–π—á–∞—Å: $line_length). –ü–æ–∂–∞–ª—É–π—Å—Ç–∞, —Å–æ–∫—Ä–∞—Ç–∏—Ç–µ –∏–ª–∏ —Ä–∞–∑–¥–µ–ª–∏—Ç–µ —Å—Ç—Ä–æ–∫—É." >&2
                continue
            fi
            
            # –î–æ–±–∞–≤–ª—è–µ–º —Å—Ç—Ä–æ–∫—É –∫ —Ç–µ–ª—É –∫–æ–º–º–∏—Ç–∞
            if ((line_count == 0)); then
                body="$line"
            else
                body+=$'\n'"$line"
            fi
            ((line_count++))
        done
        
        # –ï—Å–ª–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –Ω–∞–∂–∞–ª Ctrl+D (–ø—É—Å—Ç–æ–π –≤–≤–æ–¥ –≤ –Ω–∞—á–∞–ª–µ)
        if [[ $? -ne 0 ]] && (( line_count == 0 )); then
            echo "" >&2
            return 1
        fi
        
        printf "%s" "$body"
    }

    # 7. –ü–æ–ª—É—á–∞–µ–º —Ç–µ–ª–æ –∫–æ–º–º–∏—Ç–∞
    echo ""
    commit_body=$(get_commit_body)
    body_status=$?
    
    # –ï—Å–ª–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –æ—Ç–º–µ–Ω–∏–ª –≤–≤–æ–¥ —Ç–µ–ª–∞ –∫–æ–º–º–∏—Ç–∞
    if [[ $body_status -ne 0 ]] && [[ -z "$commit_body" ]]; then
        echo "–¢–µ–ª–æ –∫–æ–º–º–∏—Ç–∞ –Ω–µ –±—É–¥–µ—Ç –¥–æ–±–∞–≤–ª–µ–Ω–æ."
        read -rp "–ü—Ä–æ–¥–æ–ª–∂–∏—Ç—å –∫–æ–º–º–∏—Ç —Ç–æ–ª—å–∫–æ —Å –∑–∞–≥–æ–ª–æ–≤–∫–æ–º? (y/N): " confirm_body
        if [[ ! "$confirm_body" =~ ^[Yy]$ ]]; then
            echo "–û–ø–µ—Ä–∞—Ü–∏—è –æ—Ç–º–µ–Ω–µ–Ω–∞."
            return 0
        fi
    fi

    # 8. –°–æ–±–∏—Ä–∞–µ–º –ø–æ–ª–Ω–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ –∫–æ–º–º–∏—Ç–∞
    full_commit_msg="$commit_msg"
    if [[ -n "$commit_body" ]]; then
        full_commit_msg+=$'\n\n'"$commit_body"
    fi

    # –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –∏—Ç–æ–≥–æ–≤–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ
    echo ""
    echo "–°–æ–æ–±—â–µ–Ω–∏–µ –∫–æ–º–º–∏—Ç–∞:"
    echo "=================="
    echo "$full_commit_msg"
    echo "=================="
    
    read -rp "–í—ã–ø–æ–ª–Ω–∏—Ç—å –∫–æ–º–º–∏—Ç? (y/N): " final_confirm
    if [[ ! "$final_confirm" =~ ^[Yy]$ ]]; then
        echo "–û–ø–µ—Ä–∞—Ü–∏—è –æ—Ç–º–µ–Ω–µ–Ω–∞."
        return 0
    fi

    # 9. –í—ã–ø–æ–ª–Ω–µ–Ω–∏–µ –∫–æ–º–∞–Ω–¥—ã git commit
    if [[ -n "$commit_body" ]]; then
        # –î–ª—è –º–Ω–æ–≥–æ—Å—Ç—Ä–æ—á–Ω–æ–≥–æ —Å–æ–æ–±—â–µ–Ω–∏—è –∏—Å–ø–æ–ª—å–∑—É–µ–º –≤—Ä–µ–º–µ–Ω–Ω—ã–π —Ñ–∞–π–ª
        tmp_file=$(mktemp)
        echo "$full_commit_msg" > "$tmp_file"
        git commit -F "$tmp_file"
        rm -f "$tmp_file"
    else
        git commit -m "$commit_msg"
    fi
    
    # –ü—Ä–æ–≤–µ—Ä—è–µ–º —É—Å–ø–µ—à–Ω–æ—Å—Ç—å –∫–æ–º–º–∏—Ç–∞
    if [[ $? -eq 0 ]]; then
        echo "‚úì –ö–æ–º–º–∏—Ç —É—Å–ø–µ—à–Ω–æ —Å–æ–∑–¥–∞–Ω"
    else
        echo "‚úó –û—à–∏–±–∫–∞ –ø—Ä–∏ —Å–æ–∑–¥–∞–Ω–∏–∏ –∫–æ–º–º–∏—Ç–∞"
        return 1
    fi
}

function push_git_branch() {
    # –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –ª–æ–∫–∞–ª—å –¥–ª—è –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ–π —Ä–∞–±–æ—Ç—ã
    export LC_ALL="en_US.UTF-8"
    export LANG="en_US.UTF-8"
    
    echo "üîç –ù–∞—á–∏–Ω–∞–µ–º –ø—Ä–æ–≤–µ—Ä–∫–∏ –ø–µ—Ä–µ–¥ push..."
    echo ""
    
    # 1. –ü—Ä–æ–≤–µ—Ä–∫–∞, —á—Ç–æ –º—ã –≤ Git-—Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–∏
    if ! git rev-parse --git-dir > /dev/null 2>&1; then
        echo "‚ùå –û—à–∏–±–∫–∞: —Ç–µ–∫—É—â–∞—è –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏—è –Ω–µ —è–≤–ª—è–µ—Ç—Å—è Git-—Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–µ–º"
        return 1
    fi
    echo "‚úì –ù–∞—Ö–æ–¥–∏–º—Å—è –≤ Git-—Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–∏"
    
    # 2. –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å–æ—Å—Ç–æ—è–Ω–∏—è —Ä–∞–±–æ—á–µ–π –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–∏ (–Ω–µ –≤ –ø—Ä–æ—Ü–µ—Å—Å–µ merge/rebase)
    if [ -f "$(git rev-parse --git-dir)/MERGE_HEAD" ]; then
        echo "‚ùå –û—à–∏–±–∫–∞: –≤ –ø—Ä–æ—Ü–µ—Å—Å–µ —Å–ª–∏—è–Ω–∏—è (merge). –ó–∞–≤–µ—Ä—à–∏—Ç–µ –∏–ª–∏ –æ—Ç–º–µ–Ω–∏—Ç–µ merge"
        echo "   –î–ª—è –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è: git commit"
        echo "   –î–ª—è –æ—Ç–º–µ–Ω—ã: git merge --abort"
        return 1
    fi
    
    if [ -d "$(git rev-parse --git-dir)/rebase-apply" ] || [ -d "$(git rev-parse --git-dir)/rebase-merge" ]; then
        echo "‚ùå –û—à–∏–±–∫–∞: –≤ –ø—Ä–æ—Ü–µ—Å—Å–µ –ø–µ—Ä–µ–±–∞–∑–∏—Ä–æ–≤–∞–Ω–∏—è (rebase). –ó–∞–≤–µ—Ä—à–∏—Ç–µ –∏–ª–∏ –æ—Ç–º–µ–Ω–∏—Ç–µ rebase"
        echo "   –î–ª—è –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è: git rebase --continue"
        echo "   –î–ª—è –æ—Ç–º–µ–Ω—ã: git rebase --abort"
        return 1
    fi
    echo "‚úì –†–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π –Ω–µ –≤ –ø—Ä–æ—Ü–µ—Å—Å–µ —Å–ª–∏—è–Ω–∏—è/–ø–µ—Ä–µ–±–∞–∑–∏—Ä–æ–≤–∞–Ω–∏—è"
    
    # 3. –ü—Ä–æ–≤–µ—Ä–∫–∞ –Ω–µ–∑–∞–∫–æ–º–º–∏—á–µ–Ω–Ω—ã—Ö –∏–∑–º–µ–Ω–µ–Ω–∏–π (–ø—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏–µ, –Ω–µ –æ—à–∏–±–∫–∞)
    if ! git diff --quiet || ! git diff --cached --quiet; then
        echo "‚ö†Ô∏è  –ü—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏–µ: –µ—Å—Ç—å –Ω–µ–∑–∞–∫–æ–º–º–∏—á–µ–Ω–Ω—ã–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è:"
        git status --short
        echo ""
        read -rp "–ü—Ä–æ–¥–æ–ª–∂–∏—Ç—å push? (y/N): " confirm_changes
        if [[ ! "$confirm_changes" =~ ^[Yy]$ ]]; then
            echo "–û–ø–µ—Ä–∞—Ü–∏—è –æ—Ç–º–µ–Ω–µ–Ω–∞."
            return 0
        fi
    else
        echo "‚úì –ù–µ—Ç –Ω–µ–∑–∞–∫–æ–º–º–∏—á–µ–Ω–Ω—ã—Ö –∏–∑–º–µ–Ω–µ–Ω–∏–π"
    fi
    
    # 4. –ü–æ–ª—É—á–µ–Ω–∏–µ –∏–º–µ–Ω–∏ —Ç–µ–∫—É—â–µ–π –≤–µ—Ç–∫–∏
    CURRENT_BRANCH=$(git symbolic-ref --short HEAD 2>/dev/null)
    if [ -z "$CURRENT_BRANCH" ]; then
        echo "‚ùå –û—à–∏–±–∫–∞: HEAD –Ω–µ —É–∫–∞–∑—ã–≤–∞–µ—Ç –Ω–∞ –≤–µ—Ç–∫—É (detached HEAD)"
        echo "   –ü–µ—Ä–µ–∫–ª—é—á–∏—Ç–µ—Å—å –Ω–∞ –≤–µ—Ç–∫—É: git checkout <branch-name>"
        return 1
    fi
    echo "‚úì –¢–µ–∫—É—â–∞—è –≤–µ—Ç–∫–∞: $CURRENT_BRANCH"
    
    # 5. –ü—Ä–æ–≤–µ—Ä–∫–∞ –Ω–∞–ª–∏—á–∏—è —É–¥–∞–ª–µ–Ω–Ω–æ–≥–æ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏—è
    REMOTE_NAME="origin"
    if ! git remote | grep -q "^$REMOTE_NAME$"; then
        echo "‚ùå –û—à–∏–±–∫–∞: —É–¥–∞–ª–µ–Ω–Ω—ã–π —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π '$REMOTE_NAME' –Ω–µ –Ω–∞–π–¥–µ–Ω"
        echo "   –î–æ—Å—Ç—É–ø–Ω—ã–µ remote:"
        git remote -v
        echo ""
        read -rp "–í–≤–µ–¥–∏—Ç–µ –∏–º—è remote (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é: origin): " custom_remote
        REMOTE_NAME=${custom_remote:-"origin"}
        
        if ! git remote | grep -q "^$REMOTE_NAME$"; then
            echo "‚ùå –û—à–∏–±–∫–∞: remote '$REMOTE_NAME' –Ω–µ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç"
            return 1
        fi
    fi
    echo "‚úì –£–¥–∞–ª–µ–Ω–Ω—ã–π —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π: $REMOTE_NAME"
    
    # 6. –ü—Ä–æ–≤–µ—Ä–∫–∞ –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç–∏ —É–¥–∞–ª–µ–Ω–Ω–æ–≥–æ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏—è
    echo "üì° –ü—Ä–æ–≤–µ—Ä—è–µ–º –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç—å —É–¥–∞–ª–µ–Ω–Ω–æ–≥–æ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏—è..."
    if ! git ls-remote "$REMOTE_NAME" > /dev/null 2>&1; then
        echo "‚ùå –û—à–∏–±–∫–∞: —É–¥–∞–ª–µ–Ω–Ω—ã–π —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π '$REMOTE_NAME' –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω"
        echo "   –ü—Ä–æ–≤–µ—Ä—å—Ç–µ:"
        echo "   1. –°–µ—Ç–µ–≤–æ–µ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–µ"
        echo "   2. URL —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏—è: $(git remote get-url "$REMOTE_NAME" 2>/dev/null || echo '–Ω–µ–∏–∑–≤–µ—Å—Ç–µ–Ω')"
        echo "   3. –ü—Ä–∞–≤–∞ –¥–æ—Å—Ç—É–ø–∞"
        
        read -rp "–ü–æ–≤—Ç–æ—Ä–∏—Ç—å –ø–æ–ø—ã—Ç–∫—É? (y/N): " retry_remote
        if [[ "$retry_remote" =~ ^[Yy]$ ]]; then
            if ! git ls-remote "$REMOTE_NAME" > /dev/null 2>&1; then
                echo "‚ùå –ü–æ–≤—Ç–æ—Ä–Ω–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞ –Ω–µ —É–¥–∞–ª–∞—Å—å. Push –æ—Ç–º–µ–Ω–µ–Ω."
                return 1
            fi
        else
            echo "Push –æ—Ç–º–µ–Ω–µ–Ω."
            return 1
        fi
    fi
    echo "‚úì –£–¥–∞–ª–µ–Ω–Ω—ã–π —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π –¥–æ—Å—Ç—É–ø–µ–Ω"
    
    # 7. –°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è —Å —Å–µ—Ä–≤–µ—Ä–æ–º (Fetch)
    echo "üîÑ –ü–æ–ª—É—á–∞–µ–º –ø–æ—Å–ª–µ–¥–Ω–∏–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è —Å —Å–µ—Ä–≤–µ—Ä–∞..."
    if ! git fetch "$REMOTE_NAME" --quiet; then
        echo "‚ö†Ô∏è  –ü—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏–µ: –Ω–µ —É–¥–∞–ª–æ—Å—å –≤—ã–ø–æ–ª–Ω–∏—Ç—å fetch. –ü—Ä–æ–¥–æ–ª–∂–∞–µ–º —Å —Ç–µ–∫—É—â–∏–º–∏ –¥–∞–Ω–Ω—ã–º–∏."
    else
        echo "‚úì Fetch –≤—ã–ø–æ–ª–Ω–µ–Ω —É—Å–ø–µ—à–Ω–æ"
    fi
    
    # 8. –ü—Ä–æ–≤–µ—Ä–∫–∞ upstream –≤–µ—Ç–∫–∏
    UPSTREAM_BRANCH=$(git rev-parse --abbrev-ref "$CURRENT_BRANCH@{upstream}" 2>/dev/null)
    if [ -z "$UPSTREAM_BRANCH" ]; then
        echo "üìå –£ —Ç–µ–∫—É—â–µ–π –≤–µ—Ç–∫–∏ –Ω–µ—Ç upstream (—Å–≤—è–∑–∏ —Å —É–¥–∞–ª–µ–Ω–Ω–æ–π –≤–µ—Ç–∫–æ–π)"
        
        # –ü—Ä–µ–¥–ª–æ–∂–µ–Ω–∏–µ —É—Å—Ç–∞–Ω–æ–≤–∏—Ç—å upstream
        echo "   –î–æ—Å—Ç—É–ø–Ω—ã–µ –≤–µ—Ç–∫–∏ –Ω–∞ $REMOTE_NAME:"
        git branch -r | grep "$REMOTE_NAME/" | sed 's/^/   /'
        
        echo ""
        read -rp "–£—Å—Ç–∞–Ω–æ–≤–∏—Ç—å upstream –∏ –≤—ã–ø–æ–ª–Ω–∏—Ç—å push? (y/N): " setup_upstream
        if [[ ! "$setup_upstream" =~ ^[Yy]$ ]]; then
            echo "Push –æ—Ç–º–µ–Ω–µ–Ω."
            return 0
        fi
        
        # –£—Å—Ç–∞–Ω–æ–≤–∫–∞ upstream
        echo "üîº –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º upstream –¥–ª—è –≤–µ—Ç–∫–∏ $CURRENT_BRANCH..."
        git push --set-upstream "$REMOTE_NAME" "$CURRENT_BRANCH"
        return $?
    else
        echo "‚úì Upstream –≤–µ—Ç–∫–∞: $UPSTREAM_BRANCH"
    fi
    
    # 9. –°—Ä–∞–≤–Ω–µ–Ω–∏–µ –ª–æ–∫–∞–ª—å–Ω–æ–π –∏ —É–¥–∞–ª–µ–Ω–Ω–æ–π –≤–µ—Ç–æ–∫
    echo "üìä –°—Ä–∞–≤–Ω–∏–≤–∞–µ–º –ª–æ–∫–∞–ª—å–Ω—É—é –∏ —É–¥–∞–ª–µ–Ω–Ω—É—é –≤–µ—Ç–∫–∏..."
    
    # –ö–æ–º–º–∏—Ç—ã –∫–æ—Ç–æ—Ä—ã–µ –µ—Å—Ç—å —É –Ω–∞—Å, –Ω–æ –Ω–µ—Ç –Ω–∞ —É–¥–∞–ª–µ–Ω–Ω–æ–º
    LOCAL_AHEAD=$(git rev-list "$UPSTREAM_BRANCH..$CURRENT_BRANCH" --count)
    # –ö–æ–º–º–∏—Ç—ã –∫–æ—Ç–æ—Ä—ã–µ –µ—Å—Ç—å –Ω–∞ —É–¥–∞–ª–µ–Ω–Ω–æ–º, –Ω–æ –Ω–µ—Ç —É –Ω–∞—Å
    REMOTE_AHEAD=$(git rev-list "$CURRENT_BRANCH..$UPSTREAM_BRANCH" --count)
    
    echo "   –õ–æ–∫–∞–ª—å–Ω–∞—è –≤–µ—Ç–∫–∞ –æ–ø–µ—Ä–µ–∂–∞–µ—Ç —É–¥–∞–ª–µ–Ω–Ω—É—é –Ω–∞ $LOCAL_AHEAD –∫–æ–º–º–∏—Ç(–æ–≤)"
    echo "   –£–¥–∞–ª–µ–Ω–Ω–∞—è –≤–µ—Ç–∫–∞ –æ–ø–µ—Ä–µ–∂–∞–µ—Ç –ª–æ–∫–∞–ª—å–Ω—É—é –Ω–∞ $REMOTE_AHEAD –∫–æ–º–º–∏—Ç(–æ–≤)"
    
    # 10. –ê–Ω–∞–ª–∏–∑ —Å–∏—Ç—É–∞—Ü–∏–∏
    if [ "$REMOTE_AHEAD" -gt 0 ]; then
        echo "‚ö†Ô∏è  –í–Ω–∏–º–∞–Ω–∏–µ: –Ω–∞ —É–¥–∞–ª–µ–Ω–Ω–æ–º —Å–µ—Ä–≤–µ—Ä–µ –µ—Å—Ç—å –Ω–æ–≤—ã–µ –∫–æ–º–º–∏—Ç—ã, –∫–æ—Ç–æ—Ä—ã—Ö –Ω–µ—Ç —É –≤–∞—Å"
        
        if [ "$LOCAL_AHEAD" -eq 0 ]; then
            echo "   –£ –≤–∞—Å –Ω–µ—Ç –Ω–æ–≤—ã—Ö –∫–æ–º–º–∏—Ç–æ–≤. –†–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è —Å–¥–µ–ª–∞—Ç—å pull"
            read -rp "   –í—ã–ø–æ–ª–Ω–∏—Ç—å git pull –ø–µ—Ä–µ–¥ push? (y/N): " do_pull
            if [[ "$do_pull" =~ ^[Yy]$ ]]; then
                git pull "$REMOTE_NAME" "$CURRENT_BRANCH"
                if [ $? -ne 0 ]; then
                    echo "‚ùå –û—à–∏–±–∫–∞ –ø—Ä–∏ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–∏ pull. –†–∞–∑—Ä–µ—à–∏—Ç–µ –∫–æ–Ω—Ñ–ª–∏–∫—Ç—ã –∏ –ø–æ–≤—Ç–æ—Ä–∏—Ç–µ."
                    return 1
                fi
                echo "‚úì Pull –≤—ã–ø–æ–ª–Ω–µ–Ω —É—Å–ø–µ—à–Ω–æ"
            else
                echo "   –ë—É–¥–µ—Ç –≤—ã–ø–æ–ª–Ω–µ–Ω push, —á—Ç–æ –º–æ–∂–µ—Ç –≤—ã–∑–≤–∞—Ç—å –∫–æ–Ω—Ñ–ª–∏–∫—Ç—ã"
            fi
        else
            echo "   –£ –≤–∞—Å —Ç–æ–∂–µ –µ—Å—Ç—å –Ω–æ–≤—ã–µ –∫–æ–º–º–∏—Ç—ã. –í–æ–∑–º–æ–∂–Ω—ã –∫–æ–Ω—Ñ–ª–∏–∫—Ç—ã."
            echo "   –†–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è —Å–Ω–∞—á–∞–ª–∞ —Å–¥–µ–ª–∞—Ç—å: git pull --rebase"
            read -rp "   –í—ã–ø–æ–ª–Ω–∏—Ç—å rebase –ø–µ—Ä–µ–¥ push? (y/N): " do_rebase
            if [[ "$do_rebase" =~ ^[Yy]$ ]]; then
                git pull --rebase "$REMOTE_NAME" "$CURRENT_BRANCH"
                if [ $? -ne 0 ]; then
                    echo "‚ùå –û—à–∏–±–∫–∞ –ø—Ä–∏ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–∏ rebase. –†–∞–∑—Ä–µ—à–∏—Ç–µ –∫–æ–Ω—Ñ–ª–∏–∫—Ç—ã –∏ –ø–æ–≤—Ç–æ—Ä–∏—Ç–µ."
                    return 1
                fi
                echo "‚úì Rebase –≤—ã–ø–æ–ª–Ω–µ–Ω —É—Å–ø–µ—à–Ω–æ"
            fi
        fi
    fi
    
    if [ "$LOCAL_AHEAD" -eq 0 ]; then
        echo "‚ÑπÔ∏è  –ù–µ—Ç –Ω–æ–≤—ã—Ö –∫–æ–º–º–∏—Ç–æ–≤ –¥–ª—è push. –í–µ—Ç–∫–∏ —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∏—Ä–æ–≤–∞–Ω—ã."
        read -rp "   –í—ã–ø–æ–ª–Ω–∏—Ç—å push –≤ –ª—é–±–æ–º —Å–ª—É—á–∞–µ? (y/N): " push_anyway
        if [[ ! "$push_anyway" =~ ^[Yy]$ ]]; then
            echo "Push –æ—Ç–º–µ–Ω–µ–Ω."
            return 0
        fi
    fi
    
    # 11. –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ä–∞–∑–º–µ—Ä–∞ –∫–æ–º–º–∏—Ç–∞ (–∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –∏–∑–º–µ–Ω–µ–Ω–Ω—ã—Ö —Ñ–∞–π–ª–æ–≤)
    echo "üìÅ –ê–Ω–∞–ª–∏–∑–∏—Ä—É–µ–º –∏–∑–º–µ–Ω–µ–Ω–∏—è –¥–ª—è push..."
    
    # –ü–æ–ª—É—á–∞–µ–º —Å–ø–∏—Å–æ–∫ –∏–∑–º–µ–Ω–µ–Ω–Ω—ã—Ö —Ñ–∞–π–ª–æ–≤
    CHANGED_FILES=$(git diff --name-only "$UPSTREAM_BRANCH..$CURRENT_BRANCH" 2>/dev/null | wc -l)
    echo "   –ò–∑–º–µ–Ω–µ–Ω–æ —Ñ–∞–π–ª–æ–≤: $CHANGED_FILES"
    
    if [ "$CHANGED_FILES" -gt 50 ]; then
        echo "‚ö†Ô∏è  –ë–æ–ª—å—à–æ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –∏–∑–º–µ–Ω–µ–Ω–Ω—ã—Ö —Ñ–∞–π–ª–æ–≤ ($CHANGED_FILES)"
        read -rp "   –ü—Ä–æ–¥–æ–ª–∂–∏—Ç—å? (y/N): " confirm_large
        if [[ ! "$confirm_large" =~ ^[Yy]$ ]]; then
            echo "Push –æ—Ç–º–µ–Ω–µ–Ω."
            return 0
        fi
    fi
    
    # 12. –ü—Ä–æ–≤–µ—Ä–∫–∞ –Ω–∞ –Ω–∞–ª–∏—á–∏–µ –±–æ–ª—å—à–∏—Ö —Ñ–∞–π–ª–æ–≤
    echo "üíæ –ü—Ä–æ–≤–µ—Ä—è–µ–º —Ä–∞–∑–º–µ—Ä —Ñ–∞–π–ª–æ–≤..."
    
    # –°–æ–∑–¥–∞–µ–º –≤—Ä–µ–º–µ–Ω–Ω—ã–π —Ñ–∞–π–ª –¥–ª—è –∞–Ω–∞–ª–∏–∑–∞
    TEMP_DIFF=$(mktemp)
    git diff "$UPSTREAM_BRANCH..$CURRENT_BRANCH" --stat 2>/dev/null > "$TEMP_DIFF"
    
    LARGE_FILES=$(grep -E '(\|.*[0-9]{6,}.*\+)' "$TEMP_DIFF" || true)
    if [ -n "$LARGE_FILES" ]; then
        echo "‚ö†Ô∏è  –û–±–Ω–∞—Ä—É–∂–µ–Ω—ã —Ñ–∞–π–ª—ã —Å –±–æ–ª—å—à–∏–º–∏ –∏–∑–º–µ–Ω–µ–Ω–∏—è–º–∏:"
        echo "$LARGE_FILES" | sed 's/^/   /'
        read -rp "   –ü—Ä–æ–¥–æ–ª–∂–∏—Ç—å? (y/N): " confirm_large_files
        if [[ ! "$confirm_large_files" =~ ^[Yy]$ ]]; then
            rm "$TEMP_DIFF"
            echo "Push –æ—Ç–º–µ–Ω–µ–Ω."
            return 0
        fi
    fi
    rm "$TEMP_DIFF"
    
    # 13. –ü–æ–∫–∞–∑—ã–≤–∞–µ–º —á—Ç–æ –±—É–¥–µ—Ç –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–æ
    echo ""
    echo "üì§ –ß—Ç–æ –±—É–¥–µ—Ç –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–æ:"
    echo "========================"
    
    if [ "$LOCAL_AHEAD" -gt 0 ]; then
        echo "–ö–æ–º–º–∏—Ç—ã –¥–ª—è –æ—Ç–ø—Ä–∞–≤–∫–∏ ($LOCAL_AHEAD):"
        git log --oneline "$UPSTREAM_BRANCH..$CURRENT_BRANCH" 2>/dev/null | sed 's/^/   /'
    fi
    
    echo ""
    echo "–ò–∑–º–µ–Ω–µ–Ω–∏—è:"
    git diff --stat "$UPSTREAM_BRANCH..$CURRENT_BRANCH" 2>/dev/null || echo "   (–Ω–µ—Ç —Ä–∞–∑–ª–∏—á–∏–π –∏–ª–∏ –≤–µ—Ç–∫–∞ –Ω–µ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç –Ω–∞ remote)"
    
    # 14. –ü—Ä–æ–≤–µ—Ä–∫–∞ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç–∏ force push
    NEEDS_FORCE=false
    if git merge-base --is-ancestor "$UPSTREAM_BRANCH" "$CURRENT_BRANCH" 2>/dev/null; then
        echo "‚úì –ú–æ–∂–Ω–æ –≤—ã–ø–æ–ª–Ω–∏—Ç—å fast-forward push"
    else
        echo "‚ö†Ô∏è  –í–µ—Ç–∫–∏ —Ä–∞–∑–æ—à–ª–∏—Å—å. –¢—Ä–µ–±—É–µ—Ç—Å—è force push"
        NEEDS_FORCE=true
    fi
    
    # 15. –§–∏–Ω–∞–ª—å–Ω–æ–µ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ
    echo ""
    echo "========================"
    echo "–û—Ç–ø—Ä–∞–≤–∫–∞ –≤: $REMOTE_NAME/$CURRENT_BRANCH"
    
    if [ "$NEEDS_FORCE" = true ]; then
        echo "‚ö†Ô∏è  ‚ö†Ô∏è  ‚ö†Ô∏è  –í–ù–ò–ú–ê–ù–ò–ï: –±—É–¥–µ—Ç –≤—ã–ø–æ–ª–Ω–µ–Ω FORCE PUSH!"
        echo "   –≠—Ç–æ –ø–µ—Ä–µ–∑–∞–ø–∏—à–µ—Ç –∏—Å—Ç–æ—Ä–∏—é –Ω–∞ —É–¥–∞–ª–µ–Ω–Ω–æ–º —Å–µ—Ä–≤–µ—Ä–µ."
        echo "   –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ —ç—Ç–æ –Ω–µ –Ω–∞—Ä—É—à–∏—Ç —Ä–∞–±–æ—Ç—É –¥—Ä—É–≥–∏—Ö —Ä–∞–∑—Ä–∞–±–æ—Ç—á–∏–∫–æ–≤."
        echo ""
        read -rp "–ü–æ–¥—Ç–≤–µ—Ä–¥–∏—Ç–µ FORCE PUSH (–≤–≤–µ–¥–∏—Ç–µ 'FORCE'): " force_confirm
        if [ "$force_confirm" != "FORCE" ]; then
            echo "‚ùå Force push –æ—Ç–º–µ–Ω–µ–Ω."
            return 0
        fi
        PUSH_CMD="push --force-with-lease"
    else
        PUSH_CMD="push"
    fi
    
    read -rp "–í—ã–ø–æ–ª–Ω–∏—Ç—å push? (y/N): " final_confirm
    if [[ ! "$final_confirm" =~ ^[Yy]$ ]]; then
        echo "Push –æ—Ç–º–µ–Ω–µ–Ω."
        return 0
    fi
    
    # 16. –í—ã–ø–æ–ª–Ω–µ–Ω–∏–µ push
    echo ""
    echo "üöÄ –í—ã–ø–æ–ª–Ω—è–µ–º git $PUSH_CMD..."
    echo ""
    
    if [ "$NEEDS_FORCE" = true ]; then
        git push --force-with-lease "$REMOTE_NAME" "$CURRENT_BRANCH"
        PUSH_RESULT=$?
    else
        git push "$REMOTE_NAME" "$CURRENT_BRANCH"
        PUSH_RESULT=$?
    fi
    
    # 17. –û–±—Ä–∞–±–æ—Ç–∫–∞ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞
    echo ""
    if [ $PUSH_RESULT -eq 0 ]; then
        echo "‚úÖ Push –≤—ã–ø–æ–ª–Ω–µ–Ω —É—Å–ø–µ—à–Ω–æ!"
        
        # –û–±–Ω–æ–≤–ª—è–µ–º –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ –≤–µ—Ç–∫–µ –µ—Å–ª–∏ –Ω—É–∂–Ω–æ
        if [ -z "$UPSTREAM_BRANCH" ]; then
            echo "   Upstream —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω –¥–ª—è –≤–µ—Ç–∫–∏ $CURRENT_BRANCH"
        fi
        
        # –ü–æ–∫–∞–∑—ã–≤–∞–µ–º —Å—Å—ã–ª–∫—É –µ—Å–ª–∏ —ç—Ç–æ GitHub/GitLab
        REMOTE_URL=$(git remote get-url "$REMOTE_NAME" 2>/dev/null)
        if [[ "$REMOTE_URL" == *"github.com"* ]]; then
            REPO_NAME=$(echo "$REMOTE_URL" | sed -E 's/.*github.com[:/](.*)\.git/\1/')
            echo "   GitHub: https://github.com/$REPO_NAME/tree/$CURRENT_BRANCH"
        elif [[ "$REMOTE_URL" == *"gitlab.com"* ]]; then
            REPO_NAME=$(echo "$REMOTE_URL" | sed -E 's/.*gitlab.com[:/](.*)\.git/\1/')
            echo "   GitLab: https://gitlab.com/$REPO_NAME/-/tree/$CURRENT_BRANCH"
        fi
    else
        echo "‚ùå –û—à–∏–±–∫–∞ –ø—Ä–∏ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–∏ push"
        echo "   –ö–æ–¥ –æ—à–∏–±–∫–∏: $PUSH_RESULT"
        
        # –†–∞—Å—à–∏—Ñ—Ä–æ–≤–∫–∞ —Ä–∞—Å–ø—Ä–æ—Å—Ç—Ä–∞–Ω–µ–Ω–Ω—ã—Ö –æ—à–∏–±–æ–∫
        case $PUSH_RESULT in
            1)
                echo "   –í–æ–∑–º–æ–∂–Ω—ã–µ –ø—Ä–∏—á–∏–Ω—ã:"
                echo "   - –ù–µ—Ç –ø—Ä–∞–≤ –Ω–∞ –∑–∞–ø–∏—Å—å –≤ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π"
                echo "   - –í–µ—Ç–∫–∞ –∑–∞—â–∏—â–µ–Ω–∞ –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ"
                echo "   - –ö–æ–Ω—Ñ–ª–∏–∫—Ç –∏–∑–º–µ–Ω–µ–Ω–∏–π"
                ;;
            128)
                echo "   –í–æ–∑–º–æ–∂–Ω—ã–µ –ø—Ä–∏—á–∏–Ω—ã:"
                echo "   - –£–¥–∞–ª–µ–Ω–Ω—ã–π —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω"
                echo "   - –ü—Ä–æ–±–ª–µ–º—ã —Å —Å–µ—Ç—å—é"
                ;;
            *)
                echo "   –í—ã–ø–æ–ª–Ω–∏—Ç–µ –∫–æ–º–∞–Ω–¥—É –≤—Ä—É—á–Ω—É—é –¥–ª—è –¥–µ—Ç–∞–ª–µ–π:"
                echo "   git $PUSH_CMD $REMOTE_NAME $CURRENT_BRANCH"
                ;;
        esac
    fi
    
    return $PUSH_RESULT
}

# ... –ø—Ä–µ–¥—ã–¥—É—â–∏–π –∫–æ–¥ —Ñ—É–Ω–∫—Ü–∏–π

function main_menu() {
    while true; do
        echo ""
        echo "==================================="
        echo "  Git Helper - –ú–µ–Ω—é —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è"
        echo "==================================="
        echo "  1) –î–æ–±–∞–≤–∏—Ç—å —Ñ–∞–π–ª—ã –≤ –∏–Ω–¥–µ–∫—Å (add)"
        echo "  2) –°–æ–∑–¥–∞—Ç—å –∫–æ–º–º–∏—Ç (commit)"
        echo "  3) –û—Ç–ø—Ä–∞–≤–∏—Ç—å –∏–∑–º–µ–Ω–µ–Ω–∏—è (push)"
        echo "  4) –ü–æ–∫–∞–∑–∞—Ç—å —Å–ø—Ä–∞–≤–∫—É"
        echo "  0) –í—ã—Ö–æ–¥"
        echo "==================================="
        echo -n "–í—ã–±–µ—Ä–∏—Ç–µ –¥–µ–π—Å—Ç–≤–∏–µ [0-4]: "
        
        read -r choice
        
        case $choice in
            1)
                git_add_path
                ;;
            2)
                commit_git
                ;;
            3)
                push_git_branch
                ;;
            4)
                show_help
                ;;
            0)
                echo "–í—ã—Ö–æ–¥ –∏–∑ –ø—Ä–æ–≥—Ä–∞–º–º—ã."
                exit 0
                ;;
            *)
                echo "–ù–µ–≤–µ—Ä–Ω—ã–π –≤—ã–±–æ—Ä. –ü–æ–ø—Ä–æ–±—É–π—Ç–µ –µ—â–µ —Ä–∞–∑."
                ;;
        esac
        
        # –ü–∞—É–∑–∞ –ø–µ—Ä–µ–¥ —Å–ª–µ–¥—É—é—â–∏–º —Ü–∏–∫–ª–æ–º
        echo ""
        echo -n "–ù–∞–∂–º–∏—Ç–µ Enter –¥–ª—è –ø—Ä–æ–¥–æ–ª–∂–µ–Ω–∏—è..."
        read -r
        clear
    done
}

function show_help() {
    clear
    echo "==================================="
    echo "           Git Helper"
    echo "==================================="
    echo ""
    echo "–≠—Ç–æ—Ç —Å–∫—Ä–∏–ø—Ç –ø–æ–º–æ–≥–∞–µ—Ç —Ä–∞–±–æ—Ç–∞—Ç—å —Å Git:"
    echo ""
    echo "1. –î–æ–±–∞–≤–ª–µ–Ω–∏–µ —Ñ–∞–π–ª–æ–≤:"
    echo "   - –ü—Ä–æ–≤–µ—Ä—è–µ—Ç –Ω–∞–ª–∏—á–∏–µ Git-—Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏—è"
    echo "   - –ü—Ä–æ–≤–µ—Ä—è–µ—Ç —Å—É—â–µ—Å—Ç–≤–æ–≤–∞–Ω–∏–µ —Ñ–∞–π–ª–æ–≤"
    echo "   - –ü–æ–∫–∞–∑—ã–≤–∞–µ—Ç –∏–∑–º–µ–Ω–µ–Ω–∏—è –ø–µ—Ä–µ–¥ –¥–æ–±–∞–≤–ª–µ–Ω–∏–µ–º"
    echo ""
    echo "2. –°–æ–∑–¥–∞–Ω–∏–µ –∫–æ–º–º–∏—Ç–∞:"
    echo "   - –ü—Ä–æ–≤–µ—Ä—è–µ—Ç –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –∞–≤—Ç–æ—Ä–∞"
    echo "   - –í–∞–ª–∏–¥–∏—Ä—É–µ—Ç —Å–æ–æ–±—â–µ–Ω–∏–µ –∫–æ–º–º–∏—Ç–∞ (–¥–æ 50 —Å–∏–º–≤–æ–ª–æ–≤)"
    echo "   - –ü–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç —Ç–µ–ª–æ –∫–æ–º–º–∏—Ç–∞ (–¥–æ 72 —Å–∏–º–≤–æ–ª–æ–≤ –≤ —Å—Ç—Ä–æ–∫–µ)"
    echo "   - –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –Ω–æ—Ä–º–∞–ª–∏–∑—É–µ—Ç –∫–æ–¥–∏—Ä–æ–≤–∫—É"
    echo ""
    echo "3. –û—Ç–ø—Ä–∞–≤–∫–∞ –∏–∑–º–µ–Ω–µ–Ω–∏–π:"
    echo "   - –ü—Ä–æ–≤–µ—Ä—è–µ—Ç —Å–æ—Å—Ç–æ—è–Ω–∏–µ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏—è"
    echo "   - –°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∏—Ä—É–µ—Ç—Å—è —Å —É–¥–∞–ª–µ–Ω–Ω—ã–º —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–µ–º"
    echo "   - –ü–æ–∫–∞–∑—ã–≤–∞–µ—Ç —Ä–∞–∑–ª–∏—á–∏—è –ø–µ—Ä–µ–¥ –æ—Ç–ø—Ä–∞–≤–∫–æ–π"
    echo "   - –ü—Ä–µ–¥—É–ø—Ä–µ–∂–¥–∞–µ—Ç –æ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç–∏ force push"
    echo ""
    echo "–î–ª—è –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è –≤—ã–±–µ—Ä–∏—Ç–µ –ø—É–Ω–∫—Ç –∏–∑ –º–µ–Ω—é."
    echo ""
}

# –û—Å–Ω–æ–≤–Ω–∞—è –ª–æ–≥–∏–∫–∞ –∑–∞–ø—É—Å–∫–∞
if [[ $# -eq 0 ]]; then
    # –ó–∞–ø—É—Å–∫ –≤ –∏–Ω—Ç–µ—Ä–∞–∫—Ç–∏–≤–Ω–æ–º —Ä–µ–∂–∏–º–µ —Å –º–µ–Ω—é
    clear
    main_menu
else
    # –ó–∞–ø—É—Å–∫ —Å –∞—Ä–≥—É–º–µ–Ω—Ç–∞–º–∏ –∫–æ–º–∞–Ω–¥–Ω–æ–π —Å—Ç—Ä–æ–∫–∏
    case "$1" in
        "add")
            git_add_path
            ;;
        "commit")
            commit_git
            ;;
        "push")
            push_git_branch
            ;;
        "help"|"-h"|"--help")
            show_help
            ;;
        "menu"|"--menu")
            clear
            main_menu
            ;;
        *)
            echo "–ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ: $0 {add|commit|push|help|menu}"
            echo ""
            echo "–ö–æ–º–∞–Ω–¥—ã:"
            echo "  add     - –î–æ–±–∞–≤–∏—Ç—å —Ñ–∞–π–ª—ã –≤ –∏–Ω–¥–µ–∫—Å Git"
            echo "  commit  - –°–æ–∑–¥–∞—Ç—å –∫–æ–º–º–∏—Ç"
            echo "  push    - –û—Ç–ø—Ä–∞–≤–∏—Ç—å –∏–∑–º–µ–Ω–µ–Ω–∏—è –Ω–∞ —É–¥–∞–ª–µ–Ω–Ω—ã–π —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π"
            echo "  help    - –ü–æ–∫–∞–∑–∞—Ç—å —Å–ø—Ä–∞–≤–∫—É"
            echo "  menu    - –ò–Ω—Ç–µ—Ä–∞–∫—Ç–∏–≤–Ω–æ–µ –º–µ–Ω—é (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é)"
            echo ""
            exit 1
            ;;
    esac
fi

